from typing import Dict, Sequence
from src.array.base import BaseArray
from src.geometry.matrix.distance import distance, threshold_distance
from src.object.geometry_matrix import DistanceMatrix, MatrixArray
from tests.test_objects import dist_points, test_rtol, test_atol, rand_dense_arrays

import numpy as np
import pytest

pytestmark = pytest.mark.slow

single_dist_sol: Dict[str, DistanceMatrix] = {
    "30x30_float_1":
        DistanceMatrix(
        np.array(
            [[0.        , 1.80228652, 2.19789794, 2.16814009, 2.52789458,
            1.91833945, 1.99248336, 2.25572688, 2.29639519, 2.11992303,
            2.30772307, 2.10936924, 2.18266299, 2.12862424, 2.10298795,
            2.35666703, 2.41424743, 2.33691953, 2.1043387 , 2.11079535,
            2.31705226, 2.44269066, 2.39290257, 2.34303652, 2.36831326,
            2.28524684, 2.83824464, 2.11167682, 2.18577474, 2.1110106 ],
            [1.80228652, 0.        , 2.13867717, 1.94526241, 2.02981285,
                1.83859601, 2.31344012, 2.25827807, 2.07604353, 1.9175924 ,
                2.2309131 , 2.17128221, 2.09937029, 2.12976222, 1.86892062,
                2.02196734, 2.30389504, 2.07821032, 1.62355488, 2.08103295,
                2.06676868, 2.2004656 , 2.10456343, 2.00485344, 1.92331847,
                2.30629153, 2.61674361, 2.13652883, 2.01994659, 2.21261737],
            [2.19789794, 2.13867717, 0.        , 2.16845027, 2.08073343,
                1.90662701, 2.13842801, 1.93106529, 2.13327195, 1.92936143,
                2.03553386, 2.24222161, 2.22844663, 2.15597702, 1.78853749,
                2.18030248, 2.56361787, 2.22598188, 1.96554516, 1.96916365,
                1.76460679, 1.5744178 , 1.66522464, 2.43995285, 1.80437197,
                1.88391299, 1.73906145, 2.23301744, 1.8218142 , 1.69728584],
            [2.16814009, 1.94526241, 2.16845027, 0.        , 2.43734428,
                1.92111627, 2.38609912, 2.35027742, 2.66368434, 2.45404994,
                2.43471752, 2.01399102, 2.41180609, 2.43131178, 2.36811215,
                2.04745154, 2.13205262, 2.46764985, 2.34966824, 2.39785619,
                2.0833235 , 1.72190977, 2.35962329, 2.59741868, 2.35598311,
                1.97865581, 2.37407109, 1.8984315 , 1.93623271, 2.0627303 ],
            [2.52789458, 2.02981285, 2.08073343, 2.43734428, 0.        ,
                1.8522279 , 2.39329362, 1.67310568, 2.39879588, 2.20573329,
                2.23126305, 2.35158382, 2.34173784, 2.24236295, 2.08999396,
                1.85467601, 2.36234395, 1.26861704, 2.0631058 , 2.25305088,
                2.16319698, 2.03634141, 2.14859841, 2.19704749, 2.1226082 ,
                2.63724931, 2.34737136, 2.49111443, 1.99852203, 2.15232314],
            [1.91833945, 1.83859601, 1.90662701, 1.92111627, 1.8522279 ,
                0.        , 1.9001936 , 1.82664469, 2.1451634 , 1.52667629,
                2.13084368, 1.52967592, 1.83183849, 1.72261977, 2.13400155,
                2.10275749, 2.17404569, 1.89113454, 1.81775979, 1.54681181,
                1.77039387, 1.79242218, 2.07190522, 2.05276916, 1.98898543,
                2.01491974, 2.22553842, 1.67175908, 1.810067  , 1.99021942],
            [1.99248336, 2.31344012, 2.13842801, 2.38609912, 2.39329362,
                1.9001936 , 0.        , 1.83609192, 1.7433296 , 1.99602194,
                2.23125533, 2.09875406, 1.53408302, 2.01505916, 1.8642151 ,
                2.07193442, 2.17682903, 2.18160339, 1.89719995, 2.22352128,
                2.37088036, 2.00898883, 2.11568263, 2.23308371, 1.96732238,
                2.18494541, 2.16457094, 2.35512338, 2.55386154, 2.17161935],
            [2.25572688, 2.25827807, 1.93106529, 2.35027742, 1.67310568,
                1.82664469, 1.83609192, 0.        , 2.1591254 , 2.22174791,
                2.27750448, 2.48602831, 2.00462133, 1.95020222, 1.95957112,
                2.04819169, 1.63364612, 1.61489437, 1.99707495, 1.95790736,
                2.2418869 , 1.6535157 , 2.12626524, 2.17483226, 1.95331963,
                2.359177  , 1.95552299, 2.3104564 , 1.9576723 , 1.88255373],
            [2.29639519, 2.07604353, 2.13327195, 2.66368434, 2.39879588,
                2.1451634 , 1.7433296 , 2.1591254 , 0.        , 2.24104989,
                2.71659544, 2.37592514, 2.01206588, 2.13649519, 1.82833155,
                2.39360102, 2.59837065, 2.25667327, 1.80224662, 2.29297983,
                2.09543087, 2.30240748, 2.0984859 , 2.18328761, 1.96535652,
                1.98958983, 2.18780437, 2.48331805, 2.52055028, 2.52016204],
            [2.11992303, 1.9175924 , 1.92936143, 2.45404994, 2.20573329,
                1.52667629, 1.99602194, 2.22174791, 2.24104989, 0.        ,
                2.03897913, 1.9910622 , 2.09063075, 1.59039113, 2.18993145,
                2.44997495, 2.56503038, 2.4027064 , 2.14204747, 2.18479972,
                1.82399757, 1.82145362, 2.27777031, 1.99972439, 2.24745909,
                2.16005567, 2.30319329, 2.12756609, 2.05036711, 2.27927129],
            [2.30772307, 2.2309131 , 2.03553386, 2.43471752, 2.23126305,
                2.13084368, 2.23125533, 2.27750448, 2.71659544, 2.03897913,
                0.        , 2.10014497, 1.95679896, 2.08448035, 1.96545479,
                1.76383274, 2.40657596, 2.27642666, 2.50471834, 2.25342729,
                1.7613113 , 1.96926377, 2.07438453, 2.1135371 , 2.35661546,
                2.30192809, 2.2708597 , 2.4624713 , 2.20727483, 1.96960958],
            [2.10936924, 2.17128221, 2.24222161, 2.01399102, 2.35158382,
                1.52967592, 2.09875406, 2.48602831, 2.37592514, 1.9910622 ,
                2.10014497, 0.        , 1.84901764, 2.08188016, 2.05378818,
                1.94797847, 2.68289095, 2.30400539, 2.18906222, 2.06898241,
                1.75685667, 1.97843245, 2.02949285, 2.25952388, 2.04234954,
                2.15301731, 2.5270732 , 1.41498653, 2.00385858, 2.14132726],
            [2.18266299, 2.09937029, 2.22844663, 2.41180609, 2.34173784,
                1.83183849, 1.53408302, 2.00462133, 2.01206588, 2.09063075,
                1.95679896, 1.84901764, 0.        , 2.16343032, 1.80379412,
                1.82922673, 2.28581152, 2.24769487, 1.97803935, 2.14704885,
                2.06615844, 2.11179528, 1.97749854, 1.91731893, 1.82789134,
                2.05780789, 2.25302423, 1.99220716, 2.24121448, 2.06258126],
            [2.12862424, 2.12976222, 2.15597702, 2.43131178, 2.24236295,
                1.72261977, 2.01505916, 1.95020222, 2.13649519, 1.59039113,
                2.08448035, 2.08188016, 2.16343032, 0.        , 2.05812066,
                2.55099868, 2.36428703, 2.19263817, 2.32783618, 2.31942199,
                1.91747912, 1.95650521, 2.651292  , 2.11856055, 2.32080694,
                1.7205144 , 2.52978477, 2.00944667, 2.20700236, 2.17684677],
            [2.10298795, 1.86892062, 1.78853749, 2.36811215, 2.08999396,
                2.13400155, 1.8642151 , 1.95957112, 1.82833155, 2.18993145,
                1.96545479, 2.05378818, 1.80379412, 2.05812066, 0.        ,
                2.01754712, 2.47848541, 1.91347413, 1.62524   , 2.28875577,
                2.13864251, 2.065511  , 1.8849297 , 2.41509413, 1.76613666,
                2.32474706, 2.06741204, 2.14843838, 2.1629782 , 1.93891831],
            [2.35666703, 2.02196734, 2.18030248, 2.04745154, 1.85467601,
                2.10275749, 2.07193442, 2.04819169, 2.39360102, 2.44997495,
                1.76383274, 1.94797847, 1.82922673, 2.55099868, 2.01754712,
                0.        , 2.07583566, 1.88167525, 1.9898642 , 2.14648195,
                1.93954268, 1.77903551, 1.6434466 , 1.79869721, 2.00993342,
                2.55265241, 2.15316711, 2.29378642, 2.00659534, 2.22427619],
            [2.41424743, 2.30389504, 2.56361787, 2.13205262, 2.36234395,
                2.17404569, 2.17682903, 1.63364612, 2.59837065, 2.56503038,
                2.40657596, 2.68289095, 2.28581152, 2.36428703, 2.47848541,
                2.07583566, 0.        , 2.34002744, 2.49382456, 2.13755087,
                2.53768428, 1.86263887, 2.46875649, 2.23272875, 2.45595844,
                2.52858334, 2.39313632, 2.51392003, 2.1458845 , 2.3233891 ],
            [2.33691953, 2.07821032, 2.22598188, 2.46764985, 1.26861704,
                1.89113454, 2.18160339, 1.61489437, 2.25667327, 2.4027064 ,
                2.27642666, 2.30400539, 2.24769487, 2.19263817, 1.91347413,
                1.88167525, 2.34002744, 0.        , 1.93345711, 2.04297456,
                2.34969058, 2.10734545, 2.30353282, 2.38331285, 2.19735784,
                2.63280627, 2.26753311, 2.25378404, 2.12149901, 2.39744443],
            [2.1043387 , 1.62355488, 1.96554516, 2.34966824, 2.0631058 ,
                1.81775979, 1.89719995, 1.99707495, 1.80224662, 2.14204747,
                2.50471834, 2.18906222, 1.97803935, 2.32783618, 1.62524   ,
                1.9898642 , 2.49382456, 1.93345711, 0.        , 2.09101175,
                2.31304112, 2.13255029, 1.975591  , 2.04261205, 1.80474179,
                2.55810016, 2.37197987, 2.12084278, 2.38583848, 2.3623084 ],
            [2.11079535, 2.08103295, 1.96916365, 2.39785619, 2.25305088,
                1.54681181, 2.22352128, 1.95790736, 2.29297983, 2.18479972,
                2.25342729, 2.06898241, 2.14704885, 2.31942199, 2.28875577,
                2.14648195, 2.13755087, 2.04297456, 2.09101175, 0.        ,
                2.09949479, 2.10096023, 1.94402212, 2.33226564, 2.15557279,
                2.33907851, 2.32106879, 2.12281992, 1.94422885, 2.21499386],
            [2.31705226, 2.06676868, 1.76460679, 2.0833235 , 2.16319698,
                1.77039387, 2.37088036, 2.2418869 , 2.09543087, 1.82399757,
                1.7613113 , 1.75685667, 2.06615844, 1.91747912, 2.13864251,
                1.93954268, 2.53768428, 2.34969058, 2.31304112, 2.09949479,
                0.        , 1.78608872, 1.72590028, 1.88222374, 2.07638774,
                1.6594792 , 2.0593176 , 2.02380302, 1.84702462, 1.99664502],
            [2.44269066, 2.2004656 , 1.5744178 , 1.72190977, 2.03634141,
                1.79242218, 2.00898883, 1.6535157 , 2.30240748, 1.82145362,
                1.96926377, 1.97843245, 2.11179528, 1.95650521, 2.065511  ,
                1.77903551, 1.86263887, 2.10734545, 2.13255029, 2.10096023,
                1.78608872, 0.        , 2.08629036, 1.95191455, 2.01168801,
                1.97572675, 1.53918836, 2.02308933, 1.51848052, 1.9847826 ],
            [2.39290257, 2.10456343, 1.66522464, 2.35962329, 2.14859841,
                2.07190522, 2.11568263, 2.12626524, 2.0984859 , 2.27777031,
                2.07438453, 2.02949285, 1.97749854, 2.651292  , 1.8849297 ,
                1.6434466 , 2.46875649, 2.30353282, 1.975591  , 1.94402212,
                1.72590028, 2.08629036, 0.        , 2.23009189, 1.44497689,
                2.40571345, 1.91815294, 2.34052758, 2.14765406, 1.78516767],
            [2.34303652, 2.00485344, 2.43995285, 2.59741868, 2.19704749,
                2.05276916, 2.23308371, 2.17483226, 2.18328761, 1.99972439,
                2.1135371 , 2.25952388, 1.91731893, 2.11856055, 2.41509413,
                1.79869721, 2.23272875, 2.38331285, 2.04261205, 2.33226564,
                1.88222374, 1.95191455, 2.23009189, 0.        , 2.19379891,
                2.4463836 , 2.50584977, 2.50661076, 2.25779731, 2.33346373],
            [2.36831326, 1.92331847, 1.80437197, 2.35598311, 2.1226082 ,
                1.98898543, 1.96732238, 1.95331963, 1.96535652, 2.24745909,
                2.35661546, 2.04234954, 1.82789134, 2.32080694, 1.76613666,
                2.00993342, 2.45595844, 2.19735784, 1.80474179, 2.15557279,
                2.07638774, 2.01168801, 1.44497689, 2.19379891, 0.        ,
                2.36891023, 2.07080401, 2.25468215, 1.95657436, 1.82814165],
            [2.28524684, 2.30629153, 1.88391299, 1.97865581, 2.63724931,
                2.01491974, 2.18494541, 2.359177  , 1.98958983, 2.16005567,
                2.30192809, 2.15301731, 2.05780789, 1.7205144 , 2.32474706,
                2.55265241, 2.52858334, 2.63280627, 2.55810016, 2.33907851,
                1.6594792 , 1.97572675, 2.40571345, 2.4463836 , 2.36891023,
                0.        , 2.21914055, 2.00968306, 2.2644432 , 2.09941115],
            [2.83824464, 2.61674361, 1.73906145, 2.37407109, 2.34737136,
                2.22553842, 2.16457094, 1.95552299, 2.18780437, 2.30319329,
                2.2708597 , 2.5270732 , 2.25302423, 2.52978477, 2.06741204,
                2.15316711, 2.39313632, 2.26753311, 2.37197987, 2.32106879,
                2.0593176 , 1.53918836, 1.91815294, 2.50584977, 2.07080401,
                2.21914055, 0.        , 2.67005776, 2.28166039, 2.13338047],
            [2.11167682, 2.13652883, 2.23301744, 1.8984315 , 2.49111443,
                1.67175908, 2.35512338, 2.3104564 , 2.48331805, 2.12756609,
                2.4624713 , 1.41498653, 1.99220716, 2.00944667, 2.14843838,
                2.29378642, 2.51392003, 2.25378404, 2.12084278, 2.12281992,
                2.02380302, 2.02308933, 2.34052758, 2.50661076, 2.25468215,
                2.00968306, 2.67005776, 0.        , 2.00146837, 2.3366667 ],
            [2.18577474, 2.01994659, 1.8218142 , 1.93623271, 1.99852203,
                1.810067  , 2.55386154, 1.9576723 , 2.52055028, 2.05036711,
                2.20727483, 2.00385858, 2.24121448, 2.20700236, 2.1629782 ,
                2.00659534, 2.1458845 , 2.12149901, 2.38583848, 1.94422885,
                1.84702462, 1.51848052, 2.14765406, 2.25779731, 1.95657436,
                2.2644432 , 2.28166039, 2.00146837, 0.        , 2.13752933],
            [2.1110106 , 2.21261737, 1.69728584, 2.0627303 , 2.15232314,
                1.99021942, 2.17161935, 1.88255373, 2.52016204, 2.27927129,
                1.96960958, 2.14132726, 2.06258126, 2.17684677, 1.93891831,
                2.22427619, 2.3233891 , 2.39744443, 2.3623084 , 2.21499386,
                1.99664502, 1.9847826 , 1.78516767, 2.33346373, 1.82814165,
                2.09941115, 2.13338047, 2.3366667 , 2.13752933, 0.        ]])),
    "5x10_float_1":
        DistanceMatrix(
            np.array(
                [[0.        , 1.45572727, 1.57806668, 1.2537891 , 1.71038424],
                [1.45572727, 0.        , 1.33666024, 0.67721391, 1.23426127],
                [1.57806668, 1.33666024, 0.        , 1.17692081, 1.01087062],
                [1.2537891 , 0.67721391, 1.17692081, 0.        , 1.23624755],
                [1.71038424, 1.23426127, 1.01087062, 1.23624755, 0.        ]]))
}

double_dist_sol: Dict[str, DistanceMatrix] = {
    "30x30_float_1 30x30_float_2":
        DistanceMatrix(
            np.array(
                [[2.23055972, 2.16936483, 2.62618929, 2.11758659, 2.66408111,
                    2.40246714, 1.8351466 , 2.17073648, 2.1738555 , 2.13866926,
                    2.3124809 , 2.44081708, 2.66629188, 2.53703993, 2.6237036 ,
                    2.46903295, 1.82525432, 2.22022628, 2.46185592, 2.19967519,
                    2.39881889, 2.28809523, 1.98427302, 2.41040471, 2.28689019,
                    2.82656578, 2.46423297, 2.20960033, 2.28968059, 2.37744777],
                [2.05493105, 2.16564188, 2.17990831, 2.32296093, 2.08359463,
                    2.4405761 , 1.98672655, 2.34777627, 2.17642372, 1.78886043,
                    2.52896156, 1.87556111, 2.54896771, 2.28321295, 2.3570389 ,
                    1.98665556, 1.89046245, 2.42659994, 2.48381342, 2.09571593,
                    2.67399749, 1.96655351, 2.05536393, 2.1550653 , 1.67851884,
                    2.55913453, 2.4305944 , 2.31074004, 1.92781366, 2.25958801],
                [2.43488004, 2.2587329 , 2.05070097, 1.86478756, 2.29224108,
                    2.07332206, 1.89361836, 2.1338017 , 2.07623516, 2.07330857,
                    2.11803284, 2.10012243, 2.19541404, 2.1869598 , 2.10689183,
                    1.90820691, 2.0031932 , 2.10103845, 2.00007276, 2.01628547,
                    2.29652046, 1.89772735, 1.89345866, 2.15883889, 1.9514842 ,
                    2.31500852, 2.3102217 , 2.03502261, 2.20889934, 2.22462247],
                [2.29055805, 2.310397  , 2.40672913, 2.20256924, 2.41498303,
                    2.29537401, 2.08479111, 2.23983095, 1.95606385, 2.13797497,
                    2.5825193 , 2.27407799, 2.38623361, 2.46868065, 2.529232  ,
                    2.57382882, 2.02034358, 1.94957753, 2.10458906, 2.6261211 ,
                    2.36798357, 2.19199147, 1.97676298, 2.77354438, 2.39525129,
                    2.52864675, 2.49824856, 2.55447814, 2.32429734, 2.55070405],
                [2.1361376 , 2.3677016 , 2.36358788, 2.07792014, 2.09586702,
                    2.21495111, 2.0928941 , 1.95573395, 2.39742739, 2.03387529,
                    2.21097887, 1.84120606, 2.44004106, 2.25063471, 2.1240334 ,
                    1.74055014, 2.34254232, 1.9404834 , 2.46137865, 2.2359782 ,
                    2.36991802, 2.50548782, 2.03873094, 2.01536963, 1.56338161,
                    2.51326662, 2.14307158, 2.15196111, 2.42254684, 2.26145935],
                [2.07319716, 2.08375444, 2.11098961, 1.94595562, 2.01444813,
                    2.0899899 , 1.86715038, 1.57607022, 2.03764845, 1.79367725,
                    1.84737686, 1.73871805, 2.25909004, 1.90238845, 2.00002502,
                    2.02686175, 2.01086134, 1.88588042, 1.939059  , 2.10079931,
                    2.18824216, 2.00533295, 1.75096321, 2.25209848, 1.9338755 ,
                    2.08437774, 2.04172258, 2.11469489, 2.17102156, 1.90821678],
                [2.16583167, 2.04774169, 2.04743528, 2.09954751, 2.4911713 ,
                    2.00707513, 2.02637857, 2.16891385, 1.97132086, 2.10989971,
                    2.08998032, 2.30127588, 2.55426987, 2.49234071, 2.1683553 ,
                    2.15813911, 2.28947338, 2.00920613, 2.20526189, 1.74909406,
                    1.92522105, 2.003958  , 2.12446016, 2.22212264, 2.30942114,
                    2.60511478, 2.14522644, 1.87640633, 2.29726457, 2.5315771 ],
                [2.1880769 , 2.02159016, 2.18707397, 2.09497717, 2.4278381 ,
                    2.06929867, 1.84757468, 1.58572584, 2.1007436 , 1.67832059,
                    2.00120325, 2.069649  , 2.1511761 , 1.90880775, 1.54600004,
                    1.62772022, 2.0155466 , 2.08428525, 1.82093361, 2.22907156,
                    2.21195414, 2.06076133, 2.23525532, 1.82114171, 1.93596423,
                    2.33064427, 2.35166672, 2.00748376, 2.29684377, 2.20554147],
                [2.1854483 , 2.32793992, 2.32524091, 1.78578889, 2.10265789,
                    2.19222697, 2.39111672, 2.33600215, 2.21834042, 2.00841749,
                    2.38716549, 2.4205964 , 2.29671972, 2.37226917, 1.92292096,
                    1.69153606, 2.5206953 , 2.34035802, 2.40512612, 2.03492653,
                    2.43302543, 2.11769029, 1.86285345, 2.0978935 , 1.95260852,
                    2.59890271, 2.42952492, 1.93810407, 2.00479345, 2.08000307],
                [2.09422317, 1.99664286, 1.75701536, 2.40207285, 2.41768396,
                    2.48312244, 1.98640109, 2.01991278, 2.15598576, 2.11627835,
                    1.83340933, 2.1347096 , 2.49187543, 2.38227914, 2.20217304,
                    1.96178891, 2.45248052, 2.22993784, 2.3417012 , 2.11549396,
                    2.39090531, 2.13882166, 2.21504935, 2.35481478, 1.95569036,
                    2.29897939, 2.34589364, 1.96384001, 2.18825411, 2.40208634],
                [2.12830162, 1.71387888, 1.87702911, 2.41426692, 2.37477588,
                    1.96708746, 1.9894994 , 2.27033233, 2.28317908, 2.35532261,
                    2.03705405, 1.99326443, 2.54080762, 2.49316217, 2.29925088,
                    2.40172614, 2.19884652, 2.37574124, 2.3227676 , 2.30371588,
                    2.21867559, 2.27424667, 2.28138149, 2.41867369, 1.90929734,
                    2.19119742, 2.36631121, 2.00424503, 2.22775435, 2.47900311],
                [2.13386823, 2.33091795, 2.31597522, 1.93471577, 2.35030485,
                    1.79823177, 1.94847246, 2.00663451, 1.90405213, 2.28565022,
                    1.7021103 , 2.16294069, 2.50983385, 2.40779473, 2.4217245 ,
                    2.33071034, 2.35055368, 2.00466829, 2.09595953, 1.99360493,
                    2.15157164, 2.28612317, 1.4459934 , 2.72023724, 2.2044518 ,
                    2.07700433, 1.98795925, 2.23430655, 2.05272545, 2.43333434],
                [2.13333826, 2.05274341, 2.03577127, 2.34572976, 2.49630393,
                    2.00299035, 2.24704365, 2.22412534, 2.41232452, 2.32126502,
                    1.99953202, 1.84494822, 2.82569575, 1.98643392, 1.88909524,
                    1.88259279, 2.32708085, 2.36210283, 1.90456618, 1.65850276,
                    2.24695169, 2.35250186, 2.08824159, 2.26451956, 2.07541725,
                    2.31275391, 2.2875791 , 1.88582624, 2.1842384 , 2.36635056],
                [1.95229997, 2.06617864, 2.28238586, 2.28417782, 2.31549465,
                    2.13154112, 2.02967014, 1.66511851, 2.13883861, 1.60637376,
                    1.75922852, 1.99892645, 1.96552007, 2.36089852, 2.03833028,
                    1.93497108, 2.31992935, 2.29934345, 2.2289684 , 2.38153162,
                    1.99433231, 1.85194727, 2.2166153 , 2.14189573, 1.63513764,
                    2.32471878, 2.22819435, 2.1112157 , 2.05818115, 1.95095715],
                [2.27801071, 2.05041854, 2.08704882, 1.8582882 , 2.23930262,
                    1.91947176, 2.01440687, 2.19101139, 1.92171744, 1.89234471,
                    2.18389627, 2.08048514, 2.35086894, 2.11838227, 2.06774772,
                    1.76954452, 2.09327489, 2.33904528, 2.37368607, 1.58721757,
                    2.26834733, 1.67833421, 2.11798201, 1.91879823, 1.69833668,
                    2.72546736, 2.22681858, 1.92881151, 2.08498897, 2.34555225],
                [1.85504806, 2.31378358, 2.3141712 , 2.31076384, 2.18217327,
                    1.82733646, 1.96428675, 2.37043475, 2.14541492, 2.14111588,
                    2.14238633, 1.95908644, 2.52967307, 2.25493412, 2.12719164,
                    2.15773089, 2.14029638, 2.06125009, 2.22976398, 2.05050679,
                    2.36161595, 2.39739861, 1.70301644, 2.23316252, 1.98196848,
                    2.19087912, 2.26511451, 2.04053614, 2.16013924, 2.50554361],
                [2.46598084, 2.11593433, 2.44383847, 2.67951529, 2.75500983,
                    2.4791779 , 2.34027624, 2.34710325, 2.07675905, 2.0089596 ,
                    2.44533875, 2.28796243, 2.50989946, 2.50353755, 1.92040722,
                    2.42950187, 2.1337773 , 2.32703543, 2.15938258, 2.58677375,
                    2.61126631, 2.47103457, 2.55263901, 2.08404063, 2.27778504,
                    2.3657282 , 2.87906887, 2.47786178, 2.51323777, 2.67902708],
                [2.32289728, 2.07051996, 2.33270439, 2.1456156 , 2.38602529,
                    2.27208861, 1.94490489, 1.96211315, 2.39590954, 1.89788407,
                    2.13066516, 2.05633202, 2.43272951, 2.04881922, 2.30006248,
                    2.02472577, 2.11891176, 2.21743826, 2.33842907, 2.11374191,
                    2.41100243, 2.11339659, 1.98916977, 2.00383987, 1.86394695,
                    2.72657972, 2.09788418, 2.47226538, 2.53453941, 2.24116673],
                [2.46151069, 2.50612161, 2.12738333, 2.14663392, 2.17306417,
                    2.3858004 , 2.19507584, 2.15482262, 2.0435216 , 1.93391225,
                    2.56275024, 2.11791778, 2.58743115, 2.34489468, 2.30939999,
                    2.01631992, 2.07849263, 2.51191635, 2.48178025, 1.75828852,
                    2.76794688, 2.06572941, 2.04779034, 2.24928607, 2.14933545,
                    2.73200921, 2.43331329, 2.06095648, 2.15734957, 2.54471575],
                [2.54442618, 2.09834801, 2.36940534, 2.46095896, 2.6197136 ,
                    2.44941272, 2.08086279, 2.07745183, 2.32965282, 1.9609375 ,
                    1.95161362, 2.20949238, 2.57168563, 2.10612126, 2.05587545,
                    2.43550197, 2.05331761, 2.48942961, 1.95296039, 2.34875177,
                    2.71195652, 2.1380043 , 1.7478015 , 2.10657548, 2.13846998,
                    2.33249366, 2.19834605, 2.45754836, 2.3477922 , 2.05467867],
                [1.78690486, 2.03491173, 1.9780066 , 1.99255907, 1.69216152,
                    1.70601639, 1.84850393, 1.72412522, 2.28306127, 2.20752253,
                    1.84699848, 1.84769418, 1.75913   , 2.05340503, 1.66152249,
                    1.81343877, 2.10562576, 2.02890406, 1.94015326, 2.28514582,
                    2.0976556 , 2.28154964, 1.58501206, 2.45343698, 1.67145872,
                    1.41822478, 2.18422686, 1.87421879, 1.44362518, 2.08696174],
                [2.12457835, 2.06295174, 1.71009533, 2.04530246, 2.44434862,
                    1.9803783 , 1.87535897, 1.87701142, 1.58764924, 1.8082133 ,
                    1.81349596, 2.07908842, 2.04021691, 2.18094764, 1.95789509,
                    2.03130587, 2.11836016, 1.9608458 , 1.75036394, 2.26094943,
                    2.16586804, 1.97951547, 1.94352724, 2.2716673 , 2.00937469,
                    1.96223338, 2.40593222, 2.10296588, 2.22346361, 2.39617271],
                [2.20114415, 2.21404783, 2.20139611, 2.02630402, 2.07116196,
                    1.93550591, 1.89470845, 2.44118851, 2.05155822, 2.4381817 ,
                    2.20867974, 2.09490144, 2.48870326, 2.30474799, 1.88083483,
                    1.8669858 , 2.18131249, 2.11710253, 2.19126915, 1.68407722,
                    2.30180274, 2.28755248, 1.75444681, 2.32158019, 2.09467616,
                    1.89582385, 2.015811  , 1.92290546, 2.01931416, 2.3560677 ],
                [1.9995367 , 2.48238726, 2.11533257, 2.53974968, 2.46349482,
                    2.35345948, 2.39732501, 2.10996298, 2.25782007, 2.21355172,
                    2.27363506, 2.09429691, 2.54182436, 2.56881505, 2.08141142,
                    2.0587031 , 2.4569899 , 2.58933782, 2.52362749, 2.16547444,
                    2.57408216, 2.72721269, 2.1218676 , 2.44420911, 2.02357077,
                    1.85567824, 2.48672384, 2.02674281, 2.16389914, 2.4373684 ],
                [2.26445034, 2.4917227 , 2.3976557 , 2.03814928, 2.31415724,
                    1.91202171, 2.11700976, 2.27111438, 2.0551906 , 2.15779271,
                    2.2404561 , 1.69029777, 2.66878977, 2.49797842, 1.90458578,
                    1.72876907, 2.05026778, 2.34047148, 2.11957614, 1.69527051,
                    2.06260117, 2.01907436, 2.02807952, 2.34534302, 1.92131894,
                    2.19185386, 2.19480565, 2.20839154, 1.99747779, 2.34142458],
                [2.18144601, 2.00749278, 2.21367785, 2.03289455, 2.34485931,
                    2.13453001, 2.17454462, 2.12201894, 2.31305107, 2.22751868,
                    2.10930524, 2.29943117, 2.03338273, 2.27895926, 2.11907486,
                    2.16203871, 2.41551475, 2.21474586, 1.82679858, 2.56199555,
                    2.21328345, 2.27874992, 1.89062803, 2.5440722 , 2.02043251,
                    2.27499236, 2.37054807, 2.10015438, 1.97638466, 1.97660968],
                [2.54421683, 1.98607562, 1.8973303 , 2.0676509 , 2.48669628,
                    2.11687741, 1.96630106, 2.46097926, 2.2116636 , 2.50480457,
                    2.17738339, 2.30105974, 2.38539514, 2.11516636, 2.08727643,
                    2.05975157, 2.51617694, 2.06196495, 2.0004591 , 2.44694704,
                    2.39341312, 2.15803669, 2.23748595, 2.45103332, 2.18703418,
                    2.35041493, 2.47295936, 2.1181041 , 2.46495321, 2.62355253],
                [2.34179149, 2.27903307, 2.44729275, 2.25803179, 2.62448251,
                    2.43604476, 2.18833024, 2.00652933, 2.23056867, 2.21379391,
                    1.85274784, 2.25576289, 2.49681564, 2.20784782, 2.27868524,
                    2.29146725, 2.11496822, 2.30313424, 2.13788978, 2.25709768,
                    2.58551097, 2.31085437, 1.90633928, 2.62564056, 2.27030153,
                    2.36043618, 2.31152966, 2.38036515, 2.24322226, 2.4603207 ],
                [2.15436142, 2.37808943, 2.46382   , 2.26902741, 2.60610993,
                    2.24878759, 2.11721396, 1.95768141, 2.09198387, 1.82813491,
                    1.94643558, 1.89764785, 2.4314498 , 2.13306171, 1.93515839,
                    2.04668073, 2.04429125, 2.31261435, 1.87100081, 2.27080075,
                    2.32995594, 2.14472112, 1.84597125, 2.27008347, 1.92866637,
                    2.31401627, 2.64654308, 2.52015896, 2.31710478, 2.07213964],
                [2.4304341 , 2.12509119, 2.25327375, 1.99759973, 2.5495497 ,
                    1.98081364, 1.94052465, 2.02139147, 2.02008145, 2.30552485,
                    2.18870232, 2.08379581, 2.52852027, 2.56546493, 2.22744637,
                    2.07412274, 2.03329505, 1.95972723, 2.03624498, 2.09983997,
                    2.13626719, 2.23092511, 2.05528914, 2.3101918 , 2.11280327,
                    2.20330412, 1.98624324, 1.92870856, 2.47461044, 2.39113441]])),
}

threshold_sol: Dict[str, DistanceMatrix] = {
    "30x30_float_1":
        DistanceMatrix(
            np.array(
                [[0., 1.80228652, np.inf, np.inf, np.inf, 
                1.91833945, 1.99248336, np.inf, np.inf, 2.11992303, 
                np.inf, 2.10936924, np.inf, 2.12862424, 2.10298795, 
                np.inf, np.inf, np.inf, 2.1043387, 2.11079535, 
                np.inf, np.inf, np.inf, np.inf, np.inf, 
                np.inf, np.inf, 2.11167682, np.inf, 2.1110106], 
                [1.80228652, 0., np.inf, 1.94526241, 2.02981285, 
                1.83859601, np.inf, np.inf, 2.07604353, 1.9175924, 
                np.inf, np.inf, 2.09937029, 2.12976222, 1.86892062, 
                2.02196734, np.inf, 2.07821032, 1.62355488, 2.08103295, 
                2.06676868, np.inf, 2.10456343, 2.00485344, 1.92331847, 
                np.inf, np.inf, np.inf, 2.01994659, np.inf], 
                [np.inf, np.inf, 0., np.inf, 2.08073343, 
                1.90662701, np.inf, 1.93106529, np.inf, 1.92936143, 
                2.03553386, np.inf, np.inf, np.inf, 1.78853749, 
                np.inf, np.inf, np.inf, 1.96554516, 1.96916365, 
                1.76460679, 1.5744178, 1.66522464, np.inf, 1.80437197, 
                1.88391299, 1.73906145, np.inf, 1.8218142, 1.69728584], 
                [np.inf, 1.94526241, np.inf, 0., np.inf, 
                1.92111627, np.inf, np.inf, np.inf, np.inf, 
                np.inf, 2.01399102, np.inf, np.inf, np.inf, 
                2.04745154, np.inf, np.inf, np.inf, np.inf, 
                2.0833235, 1.72190977, np.inf, np.inf, np.inf, 
                1.97865581, np.inf, 1.8984315, 1.93623271, 2.0627303], 
                [np.inf, 2.02981285, 2.08073343, np.inf, 0., 
                1.8522279, np.inf, 1.67310568, np.inf, np.inf, 
                np.inf, np.inf, np.inf, np.inf, 2.08999396, 
                1.85467601, np.inf, 1.26861704, 2.0631058, np.inf, 
                np.inf, 2.03634141, np.inf, np.inf, 2.1226082, 
                np.inf, np.inf, np.inf, 1.99852203, np.inf], 
                [1.91833945, 1.83859601, 1.90662701, 1.92111627, 1.8522279, 
                0., 1.9001936, 1.82664469, np.inf, 1.52667629, 
                np.inf, 1.52967592, 1.83183849, 1.72261977, np.inf, 
                2.10275749, np.inf, 1.89113454, 1.81775979, 1.54681181, 
                1.77039387, 1.79242218, 2.07190522, 2.05276916, 1.98898543, 
                2.01491974, np.inf, 1.67175908, 1.810067, 1.99021942], 
                [1.99248336, np.inf, np.inf, np.inf, np.inf, 
                1.9001936, 0., 1.83609192, 1.7433296, 1.99602194, 
                np.inf, 2.09875406, 1.53408302, 2.01505916, 1.8642151, 
                2.07193442, np.inf, np.inf, 1.89719995, np.inf, 
                np.inf, 2.00898883, 2.11568263, np.inf, 1.96732238, 
                np.inf, np.inf, np.inf, np.inf, np.inf], 
                [np.inf, np.inf, 1.93106529, np.inf, 1.67310568, 
                1.82664469, 1.83609192, 0., np.inf, np.inf, 
                np.inf, np.inf, 2.00462133, 1.95020222, 1.95957112, 
                2.04819169, 1.63364612, 1.61489437, 1.99707495, 1.95790736, 
                np.inf, 1.6535157, 2.12626524, np.inf, 1.95331963, 
                np.inf, 1.95552299, np.inf, 1.9576723, 1.88255373], 
                [np.inf, 2.07604353, np.inf, np.inf, np.inf, 
                np.inf, 1.7433296, np.inf, 0., np.inf, 
                np.inf, np.inf, 2.01206588, np.inf, 1.82833155, 
                np.inf, np.inf, np.inf, 1.80224662, np.inf, 
                2.09543087, np.inf, 2.0984859, np.inf, 1.96535652, 
                1.98958983, np.inf, np.inf, np.inf, np.inf], 
                [2.11992303, 1.9175924, 1.92936143, np.inf, np.inf, 
                1.52667629, 1.99602194, np.inf, np.inf, 0., 
                2.03897913, 1.9910622, 2.09063075, 1.59039113, np.inf, 
                np.inf, np.inf, np.inf, np.inf, np.inf, 
                1.82399757, 1.82145362, np.inf, 1.99972439, np.inf, 
                np.inf, np.inf, 2.12756609, 2.05036711, np.inf], 
                [np.inf, np.inf, 2.03553386, np.inf, np.inf, 
                np.inf, np.inf, np.inf, np.inf, 2.03897913, 
                0., 2.10014497, 1.95679896, 2.08448035, 1.96545479, 
                1.76383274, np.inf, np.inf, np.inf, np.inf, 
                1.7613113, 1.96926377, 2.07438453, 2.1135371, np.inf, 
                np.inf, np.inf, np.inf, np.inf, 1.96960958], 
                [2.10936924, np.inf, np.inf, 2.01399102, np.inf, 
                1.52967592, 2.09875406, np.inf, np.inf, 1.9910622, 
                2.10014497, 0., 1.84901764, 2.08188016, 2.05378818, 
                1.94797847, np.inf, np.inf, np.inf, 2.06898241, 
                1.75685667, 1.97843245, 2.02949285, np.inf, 2.04234954, 
                np.inf, np.inf, 1.41498653, 2.00385858, np.inf], 
                [np.inf, 2.09937029, np.inf, np.inf, np.inf, 
                1.83183849, 1.53408302, 2.00462133, 2.01206588, 2.09063075, 
                1.95679896, 1.84901764, 0., np.inf, 1.80379412, 
                1.82922673, np.inf, np.inf, 1.97803935, np.inf, 
                2.06615844, 2.11179528, 1.97749854, 1.91731893, 1.82789134, 
                2.05780789, np.inf, 1.99220716, np.inf, 2.06258126], 
                [2.12862424, 2.12976222, np.inf, np.inf, np.inf, 
                1.72261977, 2.01505916, 1.95020222, np.inf, 1.59039113, 
                2.08448035, 2.08188016, np.inf, 0., 2.05812066, 
                np.inf, np.inf, np.inf, np.inf, np.inf, 
                1.91747912, 1.95650521, np.inf, 2.11856055, np.inf, 
                1.7205144, np.inf, 2.00944667, np.inf, np.inf], 
                [2.10298795, 1.86892062, 1.78853749, np.inf, 2.08999396, 
                np.inf, 1.8642151, 1.95957112, 1.82833155, np.inf, 
                1.96545479, 2.05378818, 1.80379412, 2.05812066, 0., 
                2.01754712, np.inf, 1.91347413, 1.62524, np.inf, 
                np.inf, 2.065511, 1.8849297, np.inf, 1.76613666, 
                np.inf, 2.06741204, np.inf, np.inf, 1.93891831], 
                [np.inf, 2.02196734, np.inf, 2.04745154, 1.85467601, 
                2.10275749, 2.07193442, 2.04819169, np.inf, np.inf, 
                1.76383274, 1.94797847, 1.82922673, np.inf, 2.01754712, 
                0., 2.07583566, 1.88167525, 1.9898642, np.inf, 
                1.93954268, 1.77903551, 1.6434466, 1.79869721, 2.00993342, 
                np.inf, np.inf, np.inf, 2.00659534, np.inf], 
                [np.inf, np.inf, np.inf, np.inf, np.inf, 
                np.inf, np.inf, 1.63364612, np.inf, np.inf, 
                np.inf, np.inf, np.inf, np.inf, np.inf, 
                2.07583566, 0., np.inf, np.inf, np.inf, 
                np.inf, 1.86263887, np.inf, np.inf, np.inf, 
                np.inf, np.inf, np.inf, np.inf, np.inf], 
                [np.inf, 2.07821032, np.inf, np.inf, 1.26861704, 
                1.89113454, np.inf, 1.61489437, np.inf, np.inf, 
                np.inf, np.inf, np.inf, np.inf, 1.91347413, 
                1.88167525, np.inf, 0., 1.93345711, 2.04297456, 
                np.inf, 2.10734545, np.inf, np.inf, np.inf, 
                np.inf, np.inf, np.inf, 2.12149901, np.inf], 
                [2.1043387, 1.62355488, 1.96554516, np.inf, 2.0631058, 
                1.81775979, 1.89719995, 1.99707495, 1.80224662, np.inf, 
                np.inf, np.inf, 1.97803935, np.inf, 1.62524, 
                1.9898642, np.inf, 1.93345711, 0., 2.09101175, 
                np.inf, np.inf, 1.975591, 2.04261205, 1.80474179, 
                np.inf, np.inf, 2.12084278, np.inf, np.inf], 
                [2.11079535, 2.08103295, 1.96916365, np.inf, np.inf, 
                1.54681181, np.inf, 1.95790736, np.inf, np.inf, 
                np.inf, 2.06898241, np.inf, np.inf, np.inf, 
                np.inf, np.inf, 2.04297456, 2.09101175, 0., 
                2.09949479, 2.10096023, 1.94402212, np.inf, np.inf, 
                np.inf, np.inf, 2.12281992, 1.94422885, np.inf], 
                [np.inf, 2.06676868, 1.76460679, 2.0833235, np.inf, 
                1.77039387, np.inf, np.inf, 2.09543087, 1.82399757, 
                1.7613113, 1.75685667, 2.06615844, 1.91747912, np.inf, 
                1.93954268, np.inf, np.inf, np.inf, 2.09949479, 
                0., 1.78608872, 1.72590028, 1.88222374, 2.07638774, 
                1.6594792, 2.0593176, 2.02380302, 1.84702462, 1.99664502], 
                [np.inf, np.inf, 1.5744178, 1.72190977, 2.03634141, 
                1.79242218, 2.00898883, 1.6535157, np.inf, 1.82145362, 
                1.96926377, 1.97843245, 2.11179528, 1.95650521, 2.065511, 
                1.77903551, 1.86263887, 2.10734545, np.inf, 2.10096023, 
                1.78608872, 0., 2.08629036, 1.95191455, 2.01168801, 
                1.97572675, 1.53918836, 2.02308933, 1.51848052, 1.9847826], 
                [np.inf, 2.10456343, 1.66522464, np.inf, np.inf, 
                2.07190522, 2.11568263, 2.12626524, 2.0984859, np.inf, 
                2.07438453, 2.02949285, 1.97749854, np.inf, 1.8849297, 
                1.6434466, np.inf, np.inf, 1.975591, 1.94402212, 
                1.72590028, 2.08629036, 0., np.inf, 1.44497689, 
                np.inf, 1.91815294, np.inf, np.inf, 1.78516767], 
                [np.inf, 2.00485344, np.inf, np.inf, np.inf, 
                2.05276916, np.inf, np.inf, np.inf, 1.99972439, 
                2.1135371, np.inf, 1.91731893, 2.11856055, np.inf, 
                1.79869721, np.inf, np.inf, 2.04261205, np.inf, 
                1.88222374, 1.95191455, np.inf, 0., np.inf, 
                np.inf, np.inf, np.inf, np.inf, np.inf], 
                [np.inf, 1.92331847, 1.80437197, np.inf, 2.1226082, 
                1.98898543, 1.96732238, 1.95331963, 1.96535652, np.inf, 
                np.inf, 2.04234954, 1.82789134, np.inf, 1.76613666, 
                2.00993342, np.inf, np.inf, 1.80474179, np.inf, 
                2.07638774, 2.01168801, 1.44497689, np.inf, 0., 
                np.inf, 2.07080401, np.inf, 1.95657436, 1.82814165], 
                [np.inf, np.inf, 1.88391299, 1.97865581, np.inf, 
                2.01491974, np.inf, np.inf, 1.98958983, np.inf, 
                np.inf, np.inf, 2.05780789, 1.7205144, np.inf, 
                np.inf, np.inf, np.inf, np.inf, np.inf, 
                1.6594792, 1.97572675, np.inf, np.inf, np.inf, 
                0., np.inf, 2.00968306, np.inf, 2.09941115], 
                [np.inf, np.inf, 1.73906145, np.inf, np.inf, 
                np.inf, np.inf, 1.95552299, np.inf, np.inf, 
                np.inf, np.inf, np.inf, np.inf, 2.06741204, 
                np.inf, np.inf, np.inf, np.inf, np.inf, 
                2.0593176, 1.53918836, 1.91815294, np.inf, 2.07080401, 
                np.inf, 0., np.inf, np.inf, np.inf], 
                [2.11167682, np.inf, np.inf, 1.8984315, np.inf, 
                1.67175908, np.inf, np.inf, np.inf, 2.12756609, 
                np.inf, 1.41498653, 1.99220716, 2.00944667, np.inf, 
                np.inf, np.inf, np.inf, 2.12084278, 2.12281992, 
                2.02380302, 2.02308933, np.inf, np.inf, np.inf, 
                2.00968306, np.inf, 0., 2.00146837, np.inf], 
                [np.inf, 2.01994659, 1.8218142, 1.93623271, 1.99852203, 
                1.810067, np.inf, 1.9576723, np.inf, 2.05036711, 
                np.inf, 2.00385858, np.inf, np.inf, np.inf, 
                2.00659534, np.inf, 2.12149901, np.inf, 1.94422885, 
                1.84702462, 1.51848052, np.inf, np.inf, 1.95657436, 
                np.inf, np.inf, 2.00146837, 0., np.inf], 
                [2.1110106, np.inf, 1.69728584, 2.0627303, np.inf, 
                1.99021942, np.inf, 1.88255373, np.inf, np.inf, 
                1.96960958, np.inf, 2.06258126, np.inf, 1.93891831, 
                np.inf, np.inf, np.inf, np.inf, np.inf, 
                1.99664502, 1.9847826, 1.78516767, np.inf, 1.82814165, 
                2.09941115, np.inf, np.inf, np.inf, 0.]]))
}

radii: float = 2.13

@pytest.mark.parametrize("key", dist_points.keys())
def test__distance__single_points_no_radius_output(key: str):
    if key in single_dist_sol.keys():
        assert np.allclose(distance(x_pts=dist_points[key], return_sp=False).data, single_dist_sol[key].data, rtol=test_rtol, atol=test_atol)

@pytest.mark.parametrize("key1", dist_points.keys())
@pytest.mark.parametrize("key2", dist_points.keys())
def test__distance__double_points_no_radius_output(key1: str, key2: str):
    key1_to_second_underscore = key1[:key1[:key1.find("_")].find("_")]
    key2_to_second_underscore = key2[:key2[:key2.find("_")].find("_")]
    if key1_to_second_underscore == key2_to_second_underscore and f"{key1} {key2}" in double_dist_sol.keys():
        assert np.allclose(
            distance(x_pts=dist_points[key1], y_pts=dist_points[key2], return_sp=False).data,
            double_dist_sol[f"{key1} {key2}"].data,
            rtol=test_rtol,
            atol=test_atol
        )

@pytest.mark.parametrize("dist_key", single_dist_sol.keys())
def test__threshold_distance__radius_output(dist_key: str):
    if dist_key in threshold_sol.keys():
        assert np.allclose(threshold_distance(single_dist_sol[dist_key], radii).data, threshold_sol[dist_key].data, rtol=test_rtol, atol=test_atol)

@pytest.mark.parametrize("rand_arr", rand_dense_arrays)
def test__threshold_distance__in_place_behavior(rand_arr: MatrixArray):
    arr_mean = np.mean(rand_arr.data)
    dummy_dist = DistanceMatrix(rand_arr)
    dummy_dist_threshold = threshold_distance(dummy_dist, arr_mean)
    assert not np.shares_memory(dummy_dist.data, dummy_dist_threshold.data)
    threshold_distance(dummy_dist, arr_mean, True)
    assert np.allclose(dummy_dist.data, dummy_dist_threshold.data, rtol=test_rtol, atol=test_atol)
